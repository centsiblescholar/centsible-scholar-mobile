---
phase: 06-data-management-ui-polish
plan: 04
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - app/_layout.tsx
  - app/(tabs)/_layout.tsx
  - app/(auth)/_layout.tsx
  - app/(onboarding)/_layout.tsx
  - app/(tabs)/dashboard.tsx
  - app/(tabs)/grades.tsx
  - app/(tabs)/behavior.tsx
  - app/(tabs)/earnings.tsx
  - app/(tabs)/learn.tsx
  - app/(tabs)/daily.tsx
  - app/(tabs)/settings.tsx
autonomous: true

must_haves:
  truths:
    - "ThemeProvider wraps the entire app in root _layout.tsx"
    - "Tab bar and header colors come from theme, not hardcoded #4F46E5"
    - "All 7 tab screens use colors from useTheme() hook, not hardcoded hex values"
    - "Every tab screen shows skeleton loading state instead of ActivityIndicator"
    - "Every tab screen shows EmptyState component when no data"
    - "Every tab screen shows ErrorState with retry button on fetch errors"
    - "All interactive elements in tab screens have 44pt minimum touch targets"
    - "Auth and onboarding layout files use theme colors"
  artifacts:
    - path: "app/_layout.tsx"
      provides: "Root layout with ThemeProvider wrapping all content"
      contains: "ThemeProvider"
    - path: "app/(tabs)/_layout.tsx"
      provides: "Tab layout using theme colors for tab bar"
      contains: "useTheme"
    - path: "app/(tabs)/dashboard.tsx"
      provides: "Dashboard with skeleton loading, empty state, error state, themed colors"
      contains: "useTheme"
  key_links:
    - from: "app/_layout.tsx"
      to: "src/theme/ThemeContext.tsx"
      via: "ThemeProvider wrapping app tree"
      pattern: "ThemeProvider"
    - from: "app/(tabs)/_layout.tsx"
      to: "src/theme/ThemeContext.tsx"
      via: "useTheme for tab bar colors"
      pattern: "useTheme.*tabActive.*tabInactive"
    - from: "app/(tabs)/dashboard.tsx"
      to: "src/components/ui/SkeletonCard.tsx"
      via: "DashboardSkeleton for loading state"
      pattern: "DashboardSkeleton|SkeletonCard"
---

<objective>
Wire ThemeProvider into the app root, migrate all 4 layout files and all 7 tab screens to useTheme(), and add skeleton/empty/error states to every tab screen.

Purpose: This is the core theme migration that touches the most visible parts of the app -- the tab bar, navigation headers, and all primary screens users interact with daily. After this plan, the 7 main screens are fully themed and polished.

Output: ThemeProvider wired at app root. All layout files and 7 tab screens use theme tokens. Every tab screen has skeleton loading, empty state, and error state with retry.
</objective>

<execution_context>
@/Users/robertisrael/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robertisrael/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-data-management-ui-polish/06-CONTEXT.md
@.planning/phases/06-data-management-ui-polish/06-RESEARCH.md
@.planning/phases/06-data-management-ui-polish/06-01-SUMMARY.md
@src/theme/colors.ts
@src/theme/index.ts
@src/theme/ThemeContext.tsx
@src/theme/commonStyles.ts
@src/components/ui/SkeletonCard.tsx
@src/components/ui/EmptyState.tsx
@src/components/ui/ErrorState.tsx
@app/_layout.tsx
@app/(tabs)/_layout.tsx
@app/(tabs)/settings.tsx
@app/(tabs)/dashboard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire ThemeProvider into app root + migrate all 4 layout files</name>
  <files>
    app/_layout.tsx
    app/(tabs)/_layout.tsx
    app/(auth)/_layout.tsx
    app/(onboarding)/_layout.tsx
  </files>
  <action>
    **1. Wire ThemeProvider into `app/_layout.tsx`:**
    - Import `ThemeProvider` from `@/theme`
    - Wrap inside QueryClientProvider > AuthProvider > RevenueCatProvider > **ThemeProvider** > StudentProvider
    - Place ThemeProvider inside AuthProvider (needs auth context) but outside StudentProvider
    - For the Stack screenOptions headerStyle, the colors need to come from the theme. Since _layout.tsx is a component, create a nested component `RootNavigator` that uses `useTheme()` to get colors and renders the Stack:
      ```tsx
      function RootNavigator() {
        const { colors } = useTheme();
        return (
          <Stack screenOptions={{
            headerStyle: { backgroundColor: colors.primary },
            headerTintColor: colors.textInverse,
            headerTitleStyle: { fontWeight: 'bold' },
          }}>
            {/* all Stack.Screen entries */}
          </Stack>
        );
      }
      ```
    - Keep StatusBar component

    **2. Migrate `app/(tabs)/_layout.tsx`:**
    - Import `useTheme` from `@/theme`
    - Replace all hardcoded hex colors:
      - `#4F46E5` -> `colors.tabActive` / `colors.primary`
      - `#9CA3AF` -> `colors.tabInactive`
      - `#fff` -> `colors.textInverse`
    - Use `const { colors } = useTheme();` at top of component

    **3. Migrate `app/(auth)/_layout.tsx`:**
    - Same pattern: import useTheme, replace hardcoded colors with theme tokens

    **4. Migrate `app/(onboarding)/_layout.tsx`:**
    - Same pattern: import useTheme, replace hardcoded colors with theme tokens
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - ThemeProvider wraps app in _layout.tsx
    - No hardcoded hex colors in any of the 4 layout files (grep for `#[0-9a-fA-F]{3,8}` excluding shadow/rgba)
    - Tab bar uses theme tokens
  </verify>
  <done>
    ThemeProvider wired at app root. All 4 layout files (root, tabs, auth, onboarding) use useTheme() for colors. Tab bar and headers are themed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate all 7 tab screens to useTheme + add skeleton/empty/error states</name>
  <files>
    app/(tabs)/dashboard.tsx
    app/(tabs)/grades.tsx
    app/(tabs)/behavior.tsx
    app/(tabs)/earnings.tsx
    app/(tabs)/learn.tsx
    app/(tabs)/daily.tsx
    app/(tabs)/settings.tsx
  </files>
  <action>
    For EACH of the 7 tab screens (dashboard, grades, behavior, earnings, learn, daily, settings):

    a. **Import and use theme:**
       - Add `import { useTheme } from '@/theme';`
       - Add `const { colors } = useTheme();` at top of component
       - Replace ALL hardcoded hex colors in StyleSheet.create and inline styles:
         - `#4F46E5` -> `colors.primary`
         - `#EEF2FF` -> `colors.primaryLight`
         - `#F3F4F6` -> `colors.backgroundSecondary`
         - `#fff` / `#ffffff` -> `colors.background` or `colors.card`
         - `#111827` -> `colors.text`
         - `#6B7280` -> `colors.textSecondary`
         - `#9CA3AF` -> `colors.textTertiary`
         - `#E5E7EB` / `#e5e7eb` -> `colors.border`
         - `#10B981` -> `colors.success`
         - `#EF4444` / `#ef4444` -> `colors.error`
         - `#DC2626` -> `colors.error`
         - `#3B82F6` -> `colors.info`
         - `#F97316` -> `colors.warning`
         - `#FEE2E2` -> use tints.red
         - `#ECFDF5` -> use tints.green
         - `#D1D5DB` -> `colors.borderDark`
         - `#A5B4FC` -> `indigo[300]` (for Switch trackColor)
         - `#F9FAFB` -> `colors.backgroundSecondary` (gray[50])
       - Convert StyleSheet.create to use dynamic styles where hex was used. Two approaches depending on complexity:
         - For screens with few hardcoded values: use inline style overrides `[styles.base, { backgroundColor: colors.primary }]`
         - For screens with many hardcoded values (like settings.tsx with ~30): convert to a `createStyles(colors)` factory function that returns StyleSheet.create result, called with `const styles = createStyles(colors)` after useTheme
       - **Settings.tsx specific:** The settings screen has many hardcoded colors. Convert its entire StyleSheet.create to a `createStyles(colors: ThemeColors)` factory function.

    b. **Add skeleton loading state:**
       - Import `SkeletonCard` or `SkeletonList` or `DashboardSkeleton` from `@/components/ui/SkeletonCard`
       - Replace existing `<ActivityIndicator>` loading states with appropriate skeleton component
       - Dashboard: use `DashboardSkeleton`
       - List screens (grades, behavior, earnings): use `SkeletonList` with count matching typical list items
       - Settings: keep simple loading since it loads fast (or use SkeletonList with 3 items)
       - Daily: skeleton for the assessment wizard content area
       - Learn: skeleton for the QOD stats cards

    c. **Add empty state:**
       - Import `EmptyState` from `@/components/ui/EmptyState`
       - When data query returns empty array/null, show EmptyState with appropriate:
         - Dashboard: icon="home-outline", title="Welcome to Centsible Scholar", description="Your dashboard will show your progress here."
         - Grades: icon="school-outline", title="No Grades Yet", description="Grades will appear here once they're entered."
         - Behavior: icon="checkmark-circle-outline", title="No Assessments Yet", description="Complete your daily assessment to see behavior scores."
         - Earnings: icon="wallet-outline", title="No Earnings Yet", description="Earnings will appear once grades are entered."
         - Learn (parent): icon="bulb-outline", title="No Student Data", description="Student progress will appear here."

    d. **Add error state with retry:**
       - Import `ErrorState` from `@/components/ui/ErrorState`
       - When data query has error, show ErrorState with message and refetch as onRetry
       - Pattern: `if (error) return <ErrorState message={error.message} onRetry={refetch} />;`

    e. **Ensure 44pt touch targets:**
       - All TouchableOpacity components must have minHeight: 44 (or equivalent padding that achieves 44pt)
       - Check button heights, list item tap areas, icon buttons
       - Add `minHeight: sizing.touchTarget` where needed (44pt from spacing.ts)

    **CRITICAL ordering in each screen:**
    ```tsx
    if (isLoading) return <SkeletonList />;
    if (error) return <ErrorState message={error.message} onRetry={refetch} />;
    if (!data?.length) return <EmptyState icon="..." title="..." description="..." />;
    return <ActualContent data={data} />;
    ```
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - No hardcoded hex colors remain in any tab screen StyleSheet (grep for `#[0-9a-fA-F]{6}` in modified files should return zero or near-zero, excluding shadow/rgba)
    - All 7 tab screens have skeleton loading, empty state, and error state
    - All touch targets are >= 44pt
  </verify>
  <done>
    All 7 tab screens migrated from hardcoded colors to useTheme(). Every data-fetching tab screen has skeleton loading, empty state, and error state. 44pt touch targets enforced throughout.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no type errors
2. ThemeProvider wraps the app in root _layout.tsx
3. Tab bar uses theme tokens for active/inactive colors
4. All 7 tab screens use useTheme() hook for colors
5. All tab screens show skeleton loading (no ActivityIndicator)
6. All tab screens show EmptyState when no data
7. All tab screens show ErrorState with retry on errors
8. All touch targets >= 44pt in tab screens
9. No hardcoded hex colors in layout or tab screen files (excluding shadow/rgba)
</verification>

<success_criteria>
- ThemeProvider at app root enables dark mode switching
- All 4 layout files use theme colors for headers and tab bars
- All 7 tab screens use useTheme() for all color values
- Every data-fetching tab screen follows skeleton -> error -> empty -> content pattern
- Friendly empty states guide users (not just "no data")
- Error states have retry buttons for self-service recovery
- 44pt minimum touch targets on all interactive elements in tab screens
</success_criteria>

<output>
After completion, create `.planning/phases/06-data-management-ui-polish/06-04-SUMMARY.md`
</output>
