---
phase: 06-data-management-ui-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/theme/ThemeContext.tsx
  - src/theme/colors.ts
  - src/theme/commonStyles.ts
  - src/theme/index.ts
  - src/components/ui/SkeletonCard.tsx
  - src/components/ui/EmptyState.tsx
  - src/components/ui/ErrorState.tsx
  - src/components/ui/LoadingOverlay.tsx
  - eslint.config.js
  - package.json
  - DESIGN_SYSTEM.md
autonomous: true

must_haves:
  truths:
    - "useTheme() returns current theme colors, isDark boolean, and setMode function"
    - "ThemeProvider wraps the app and responds to system color scheme changes"
    - "commonStyles can be generated dynamically for any ThemeColors value"
    - "SkeletonCard renders shimmer animation using moti/skeleton"
    - "EmptyState shows icon, title, description, and optional action button"
    - "ErrorState shows error message with retry button"
    - "ESLint no-color-literals rule catches hardcoded color strings in StyleSheet"
    - "DESIGN_SYSTEM.md documents theme structure, useTheme usage, component examples, and dos/don'ts"
  artifacts:
    - path: "src/theme/ThemeContext.tsx"
      provides: "ThemeProvider component and useTheme hook"
      exports: ["ThemeProvider", "useTheme"]
    - path: "src/theme/commonStyles.ts"
      provides: "createCommonStyles factory function"
      exports: ["createCommonStyles"]
    - path: "src/components/ui/SkeletonCard.tsx"
      provides: "Reusable skeleton loading component"
      exports: ["SkeletonCard", "SkeletonList"]
    - path: "src/components/ui/EmptyState.tsx"
      provides: "Reusable empty state component"
      exports: ["EmptyState"]
    - path: "src/components/ui/ErrorState.tsx"
      provides: "Reusable inline error with retry"
      exports: ["ErrorState"]
    - path: "src/components/ui/LoadingOverlay.tsx"
      provides: "Modal progress overlay for export"
      exports: ["LoadingOverlay"]
    - path: "eslint.config.js"
      provides: "ESLint config with no-color-literals rule"
    - path: "DESIGN_SYSTEM.md"
      provides: "Design system documentation with theme structure, usage examples, dos/don'ts"
  key_links:
    - from: "src/theme/ThemeContext.tsx"
      to: "src/theme/colors.ts"
      via: "imports lightTheme and darkTheme"
      pattern: "import.*lightTheme.*darkTheme.*from.*colors"
    - from: "src/theme/ThemeContext.tsx"
      to: "@react-native-async-storage/async-storage"
      via: "persists theme mode preference"
      pattern: "AsyncStorage.*theme-mode"
    - from: "src/theme/index.ts"
      to: "src/theme/ThemeContext.tsx"
      via: "re-exports ThemeProvider and useTheme"
      pattern: "export.*ThemeProvider.*useTheme"
    - from: "src/components/ui/SkeletonCard.tsx"
      to: "moti/skeleton"
      via: "imports Skeleton component"
      pattern: "import.*Skeleton.*from.*moti/skeleton"
---

<objective>
Create the design system foundation: ThemeContext for dark mode support, reusable UI state components (skeleton, empty, error, loading overlay), ESLint enforcement to prevent future hardcoded colors, and design system documentation.

Purpose: All subsequent UI work (Plans 02-06) builds on these primitives. ThemeContext enables dark mode and provides the `useTheme()` hook that replaces static `colors` imports. The UI state components provide consistent loading/error/empty patterns across all screens. DESIGN_SYSTEM.md documents the theme structure for ongoing reference.

Output: ThemeContext provider, useTheme hook, createCommonStyles factory, 4 reusable UI components, ESLint config with no-color-literals rule, DESIGN_SYSTEM.md documentation, all required npm packages installed.
</objective>

<execution_context>
@/Users/robertisrael/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robertisrael/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-data-management-ui-polish/06-CONTEXT.md
@.planning/phases/06-data-management-ui-polish/06-RESEARCH.md
@src/theme/colors.ts
@src/theme/typography.ts
@src/theme/spacing.ts
@src/theme/commonStyles.ts
@src/theme/index.ts
@app/_layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and create ThemeContext + useTheme + factory commonStyles</name>
  <files>
    package.json
    src/theme/ThemeContext.tsx
    src/theme/colors.ts
    src/theme/commonStyles.ts
    src/theme/index.ts
  </files>
  <action>
    1. Install required packages:
       ```
       npx expo install expo-file-system expo-sharing expo-linear-gradient
       npm install moti eslint-plugin-react-native
       ```
       Note: expo-file-system and expo-sharing are for Plans 02/03 but install now to avoid duplicate installs.

    2. Create `src/theme/ThemeContext.tsx`:
       - ThemeProvider component that wraps children
       - Uses `useColorScheme()` from react-native for system preference
       - Stores user preference ('light' | 'dark' | 'system') in AsyncStorage under key 'theme-mode'
       - On mount, loads stored preference from AsyncStorage (defaults to 'system')
       - Computes `isDark` based on mode: if 'system', use system scheme; else use explicit mode
       - Selects `lightTheme` or `darkTheme` from colors.ts based on isDark
       - Context value: `{ colors: ThemeColors, mode: ThemeMode, isDark: boolean, setMode: (mode: ThemeMode) => void }`
       - Export both `ThemeProvider` component and `useTheme()` hook
       - useTheme throws if used outside provider (standard pattern)
       - Import ThemeColors type from colors.ts

    3. Update `src/theme/colors.ts`:
       - Keep `export const colors = lightTheme` for backward compatibility during migration
       - Add a comment: `// DEPRECATED: Use useTheme().colors instead. This static export will be removed after migration.`
       - No other changes needed -- lightTheme and darkTheme already exist

    4. Refactor `src/theme/commonStyles.ts`:
       - Convert from static StyleSheet.create (which imports static `colors`) to a factory function:
         `export function createCommonStyles(themeColors: ThemeColors)`
       - The factory takes ThemeColors and returns the same structure (cardStyles, buttonStyles, inputStyles, listStyles, badgeStyles, containerStyles, modalStyles, statStyles, emptyStateStyles)
       - Keep the existing static exports AS WELL for backward compat:
         `export const cardStyles = createCommonStyles(lightTheme).cardStyles;` etc.
       - This lets new code use `const styles = createCommonStyles(colors)` from useTheme while old code still works

    5. Update `src/theme/index.ts`:
       - Add re-exports: `export { ThemeProvider, useTheme } from './ThemeContext';`
       - Add re-export: `export { createCommonStyles } from './commonStyles';`
       - Keep all existing exports intact
  </action>
  <verify>
    - `npx tsc --noEmit` passes (no type errors)
    - ThemeContext.tsx exports ThemeProvider and useTheme
    - commonStyles.ts exports createCommonStyles function AND backward-compat static exports
    - index.ts re-exports new items
  </verify>
  <done>
    ThemeProvider and useTheme hook exist and are exported from @/theme. commonStyles has both factory and static exports. All new packages installed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create reusable UI state components, ESLint config, and design system documentation</name>
  <files>
    src/components/ui/SkeletonCard.tsx
    src/components/ui/EmptyState.tsx
    src/components/ui/ErrorState.tsx
    src/components/ui/LoadingOverlay.tsx
    eslint.config.js
    DESIGN_SYSTEM.md
  </files>
  <action>
    1. Create `src/components/ui/SkeletonCard.tsx`:
       - Import `Skeleton` from `moti/skeleton` and `MotiSkeletonProps` type if available
       - Import `useTheme` from `@/theme`
       - `SkeletonCard` component: Renders a card-shaped skeleton with configurable height, width, and border radius
         - Uses `Skeleton.Group show={true}` wrapper
         - Gets `isDark` from useTheme to set `colorMode` prop on Skeleton
         - Default: height 120, radius 12 (card-like)
         - Props: `{ height?: number, width?: number | string, radius?: number, lines?: number }`
         - If `lines` provided, render additional Skeleton bars below the main one (for text-like loading)
       - `SkeletonList` component: Renders N SkeletonCards in a vertical list with gaps
         - Props: `{ count?: number, cardHeight?: number }` (default count=3)
         - Maps count to SkeletonCard instances with spacing[3] gaps between them
       - `DashboardSkeleton` component: Specific skeleton matching dashboard layout
         - Hero card skeleton (height 120) + 3 metric card skeletons in a row + 2 section skeletons
       - Export all three: `SkeletonCard`, `SkeletonList`, `DashboardSkeleton`

       IMPORTANT: If moti/skeleton causes import issues with New Architecture, fall back to a simple shimmer using react-native-reanimated directly:
       - Create a `ShimmerPlaceholder` using Animated.View with a repeating translateX animation
       - Use LinearGradient from expo-linear-gradient for the shimmer effect
       - Match the same component API (SkeletonCard, SkeletonList)
       This fallback path should only be used if moti import fails at runtime.

    2. Create `src/components/ui/EmptyState.tsx`:
       - Props: `{ icon: string (Ionicons name), title: string, description?: string, actionLabel?: string, onAction?: () => void }`
       - Centered layout with: large icon (48px, textTertiary color), title (h3 style), description (body style, textSecondary), optional button (primary style)
       - All colors from useTheme().colors
       - 44pt minimum touch target on action button
       - Use spacing tokens from @/theme for all padding/margins

    3. Create `src/components/ui/ErrorState.tsx`:
       - Props: `{ message: string, onRetry?: () => void }`
       - Inline layout (not full-screen): error icon (alert-circle, error color), message text, "Try Again" button
       - Uses useTheme().colors for all colors
       - Button has 44pt minimum height
       - Designed to be placed inline where content would normally render

    4. Create `src/components/ui/LoadingOverlay.tsx`:
       - Props: `{ visible: boolean, message?: string, progress?: number }`
       - Modal overlay (semi-transparent black background)
       - Centered card with: ActivityIndicator or progress bar, message text
       - If `progress` provided (0-100), show a horizontal progress bar instead of spinner
       - Progress bar: colored fill (primary color) inside gray track, percentage text below
       - If no progress, show ActivityIndicator with message
       - Uses Modal from react-native with transparent=true, animationType="fade"
       - All colors from useTheme().colors

    5. Create `eslint.config.js` (flat config format):
       - Import eslint-plugin-react-native
       - Enable `react-native/no-color-literals` as `'warn'` (not error -- there are 660 existing violations)
       - Enable `react-native/no-inline-styles` as `'warn'`
       - Scope to `**/*.tsx` and `**/*.ts` files, exclude node_modules and supabase/functions
       - Add comment explaining: "Set to 'warn' during migration. Change to 'error' after Phase 6 migration complete."

    6. Create `DESIGN_SYSTEM.md` at the project root:
       Document the theme structure, usage examples, and guidelines. Include:

       a. **Overview**: Brief intro to the design system -- single source of truth for colors, typography, spacing, and reusable UI components.

       b. **Theme Structure**: Describe `src/theme/` directory:
          - `colors.ts`: lightTheme and darkTheme objects with all color tokens (primary, secondary, background, text, semantic colors, tints)
          - `typography.ts`: font sizes, weights, line heights, getFontFamily()
          - `spacing.ts`: 8pt grid spacing tokens and sizing constants (touchTarget: 44)
          - `commonStyles.ts`: createCommonStyles(colors) factory for card, button, input, list, badge, container, modal, stat, emptyState shared styles
          - `ThemeContext.tsx`: ThemeProvider and useTheme() hook for reactive theme access
          - `index.ts`: barrel exports

       c. **Usage Examples**:
          - How to access theme in a screen: `const { colors, isDark } = useTheme();`
          - How to create dynamic styles: `const styles = createStyles(colors);` with a `createStyles(colors: ThemeColors)` factory
          - How to use common styles: `const common = createCommonStyles(colors);`
          - How to use spacing: `import { spacing, sizing } from '@/theme';`
          - How to use typography: `import { typography } from '@/theme';`

       d. **UI Components**:
          - `SkeletonCard` / `SkeletonList` / `DashboardSkeleton`: usage and props
          - `EmptyState`: usage with icon, title, description, optional action
          - `ErrorState`: usage with message and retry
          - `LoadingOverlay`: usage with progress bar or spinner

       e. **Color Token Reference**: Table of key tokens (primary, secondary, background, text, textSecondary, textTertiary, border, success, error, warning, info, card, etc.) with their light and dark mode values

       f. **Dos and Don'ts**:
          - DO: Use `useTheme().colors` for all color values
          - DO: Use `spacing` tokens for margins/padding (8pt grid)
          - DO: Use `sizing.touchTarget` (44pt) for minimum touch targets
          - DO: Use `createStyles(colors)` factory pattern for StyleSheet
          - DON'T: Hardcode hex color values (`#4F46E5`) in StyleSheet or inline styles
          - DON'T: Import `colors` directly from `@/theme` (deprecated static export)
          - DON'T: Use inline styles for colors -- ESLint `no-color-literals` will warn
          - DON'T: Use raw numbers for spacing -- use spacing tokens

       g. **Dark Mode**: How the theme system handles dark mode (system detection, manual override, AsyncStorage persistence)

       h. **ESLint Enforcement**: Mention `no-color-literals` and `no-inline-styles` rules (currently warn, will become error after migration)

       Keep it concise and practical (aim for ~150-200 lines). This is a reference doc for Claude and the developer, not a marketing piece.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - All 4 component files exist and export their named components
    - eslint.config.js exists and is valid JavaScript
    - `npx eslint --print-config src/theme/colors.ts 2>/dev/null` shows react-native rules (or at minimum, eslint.config.js parses without error)
    - DESIGN_SYSTEM.md exists at project root with theme structure, usage examples, color reference, and dos/don'ts sections
  </verify>
  <done>
    SkeletonCard, SkeletonList, DashboardSkeleton, EmptyState, ErrorState, and LoadingOverlay components exist with theme-aware coloring. ESLint config warns on hardcoded colors. DESIGN_SYSTEM.md documents the complete theme system with usage examples and guidelines.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `useTheme` hook returns colors, isDark, mode, setMode when used inside ThemeProvider
3. `createCommonStyles(darkTheme)` returns dark-themed style objects
4. Backward-compatible `import { colors } from '@/theme'` still works
5. All 4 UI components (SkeletonCard, EmptyState, ErrorState, LoadingOverlay) import and render without error
6. `eslint.config.js` loads without parse errors
7. DESIGN_SYSTEM.md exists and documents theme structure, usage examples, dos/don'ts
</verification>

<success_criteria>
- ThemeProvider + useTheme hook provide reactive theme colors with system preference detection and AsyncStorage persistence
- createCommonStyles factory generates themed styles from any ThemeColors object
- Static `colors` export still works for backward compatibility during migration
- Four reusable UI state components exist with consistent theme-aware styling
- ESLint no-color-literals rule is configured to warn on hardcoded color values
- DESIGN_SYSTEM.md documents theme structure, useTheme usage, component examples, color token reference, and dos/don'ts
- All new npm packages (moti, expo-linear-gradient, expo-file-system, expo-sharing, eslint-plugin-react-native) installed
</success_criteria>

<output>
After completion, create `.planning/phases/06-data-management-ui-polish/06-01-SUMMARY.md`
</output>
