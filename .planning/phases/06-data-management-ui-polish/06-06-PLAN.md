---
phase: 06-data-management-ui-polish
plan: 06
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - app/edit-profile.tsx
  - app/paywall.tsx
  - app/manage-subscription.tsx
  - app/student-management.tsx
  - app/grade-approval.tsx
  - app/term-tracking.tsx
  - app/family-meetings.tsx
  - app/data-export.tsx
  - app/delete-account.tsx
autonomous: true

must_haves:
  truths:
    - "All 9 modal/secondary screens use colors from useTheme() hook, not hardcoded hex values"
    - "Every data-fetching modal screen shows skeleton loading state instead of ActivityIndicator"
    - "Every data-fetching modal screen shows EmptyState component when no data"
    - "Every data-fetching modal screen shows ErrorState with retry button on fetch errors"
    - "All interactive elements have 44pt minimum touch targets"
    - "Paywall and manage-subscription screens maintain their existing visual design with theme tokens"
  artifacts:
    - path: "app/paywall.tsx"
      provides: "Paywall screen with themed colors and plan card styling"
      contains: "useTheme"
    - path: "app/student-management.tsx"
      provides: "Student management with skeleton loading, empty state, error state, themed colors"
      contains: "useTheme"
    - path: "app/edit-profile.tsx"
      provides: "Edit profile with skeleton loading, error state, themed colors"
      contains: "useTheme"
  key_links:
    - from: "app/paywall.tsx"
      to: "src/theme/ThemeContext.tsx"
      via: "useTheme for plan card and pricing colors"
      pattern: "useTheme"
    - from: "app/student-management.tsx"
      to: "src/components/ui/EmptyState.tsx"
      via: "Empty state when no students"
      pattern: "EmptyState"
    - from: "app/grade-approval.tsx"
      to: "src/components/ui/ErrorState.tsx"
      via: "Error state with retry on fetch failure"
      pattern: "ErrorState"
---

<objective>
Migrate all 9 modal and secondary screens to useTheme(), and add skeleton loading, empty state, and error state to every data-fetching modal screen.

Purpose: These screens complete the theme migration across the entire app. Modal screens (paywall, manage-subscription, student-management, grade-approval, term-tracking, family-meetings, edit-profile) and the data/privacy screens (data-export, delete-account) need the same polish treatment as the tab screens. After this plan, zero hardcoded hex colors remain anywhere in the app (excluding theme definitions and shadow/rgba).

Output: All 9 modal/secondary screens use useTheme(). All data-fetching modals have skeleton/empty/error states. The entire app is dark-mode-ready.
</objective>

<execution_context>
@/Users/robertisrael/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robertisrael/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-data-management-ui-polish/06-CONTEXT.md
@.planning/phases/06-data-management-ui-polish/06-RESEARCH.md
@.planning/phases/06-data-management-ui-polish/06-01-SUMMARY.md
@src/theme/colors.ts
@src/theme/index.ts
@src/theme/ThemeContext.tsx
@src/components/ui/SkeletonCard.tsx
@src/components/ui/EmptyState.tsx
@src/components/ui/ErrorState.tsx
@app/paywall.tsx
@app/student-management.tsx
@app/edit-profile.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate modal and secondary screens to useTheme</name>
  <files>
    app/edit-profile.tsx
    app/paywall.tsx
    app/manage-subscription.tsx
    app/student-management.tsx
    app/grade-approval.tsx
    app/term-tracking.tsx
    app/family-meetings.tsx
    app/data-export.tsx
    app/delete-account.tsx
  </files>
  <action>
    Migrate all 9 modal/secondary screen files to use `useTheme()` instead of hardcoded hex colors. This is systematic, mechanical work applying the same pattern as Plans 04/05.

    **For each file:**
    1. Add `import { useTheme } from '@/theme';`
    2. Add `const { colors } = useTheme();` at top of component
    3. Replace hardcoded hex colors using the standard mapping:
       - `#4F46E5` -> `colors.primary`
       - `#EEF2FF` -> `colors.primaryLight`
       - `#F3F4F6` -> `colors.backgroundSecondary`
       - `#fff`/`#ffffff` -> `colors.background` or `colors.card` or `colors.textInverse`
       - `#111827` -> `colors.text`
       - `#6B7280` -> `colors.textSecondary`
       - `#9CA3AF` -> `colors.textTertiary`
       - `#E5E7EB` -> `colors.border`
       - `#10B981` -> `colors.success`
       - `#EF4444`/`#DC2626` -> `colors.error`
       - `#3B82F6` -> `colors.info`
       - `#F97316` -> `colors.warning`
       - Any other hex -> find closest theme token
    4. For screens with heavy inline styles, convert to `createStyles(colors)` factory pattern
    5. Ensure 44pt minimum touch targets on all interactive elements

    **Screen-specific notes:**

    - **Paywall (paywall.tsx):** Heavy styling with plan cards, billing toggle, pricing text. ~30+ hardcoded values. Convert to `createStyles(colors)` factory. Keep the current visual hierarchy (highlighted plan card, pricing emphasis).

    - **Manage subscription (manage-subscription.tsx):** Green success colors for active status, red for expired. Use `colors.success` and `colors.error` for status badges.

    - **Student management (student-management.tsx):** Student cards with status colors. Use theme semantic colors for active/inactive states.

    - **Grade approval (grade-approval.tsx):** Pending/approved/rejected status colors. Use semantic theme tokens.

    - **Edit profile (edit-profile.tsx):** Form inputs with focus/error border colors. Use `colors.primary` for focus, `colors.error` for validation errors.

    - **Term tracking (term-tracking.tsx):** Calendar/timeline styling. Use theme tokens for active/inactive term indicators.

    - **Family meetings (family-meetings.tsx):** Meeting cards with date/status. Use theme tokens.

    - **Data export (data-export.tsx) and delete-account (delete-account.tsx):** These were created in Plans 02/03. If they used hardcoded colors (likely, since those plans execute before Plan 01's theme is wired), migrate them now. delete-account.tsx should use `colors.error` for destructive elements.

    **After migration, verify no hardcoded colors remain:**
    The only acceptable remaining hex values across the ENTIRE app are:
    - Shadow colors (`shadowColor: '#000'`) -- platform-level, always black
    - rgba values for overlays (`rgba(0, 0, 0, 0.5)`) -- modal overlays
    - Colors defined IN the theme files themselves (colors.ts)
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Grep for hardcoded hex colors across ALL screen files (app/ and src/components/) shows zero matches (excluding shadow/rgba and theme definition files)
    - All 9 files import and use useTheme()
    - All touch targets >= 44pt
  </verify>
  <done>
    All 9 modal/secondary screens use useTheme() for colors. Combined with Plans 04 and 05, zero hardcoded hex values remain anywhere in the app outside of theme definitions and shadow/rgba exceptions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add skeleton/empty/error states to all data-fetching modal screens</name>
  <files>
    app/edit-profile.tsx
    app/student-management.tsx
    app/grade-approval.tsx
    app/term-tracking.tsx
    app/family-meetings.tsx
    app/manage-subscription.tsx
  </files>
  <action>
    Add skeleton loading, error state with retry, and empty state to all data-fetching modal/secondary screens.

    **For each screen that fetches data (uses React Query hooks):**

    1. **Replace ActivityIndicator with appropriate skeleton:**
       - `edit-profile.tsx`: Simple form skeleton (3-4 SkeletonCard with height=48 for input fields)
       - `student-management.tsx`: SkeletonList with count=3 for student cards
       - `grade-approval.tsx`: SkeletonList with count=3 for pending approval cards
       - `term-tracking.tsx`: SkeletonCard for term overview + SkeletonList for term list
       - `family-meetings.tsx`: SkeletonList with count=2 for meeting cards
       - `manage-subscription.tsx`: SkeletonCard for subscription status card

    2. **Add ErrorState with retry:**
       - Import ErrorState from `@/components/ui/ErrorState`
       - When query has error: `if (error) return <ErrorState message={error.message} onRetry={refetch} />;`
       - Wrap in SafeAreaView or container with proper themed background

    3. **Add EmptyState where appropriate:**
       - `student-management.tsx`: icon="people-outline", title="No Students", description="Add your first student to get started!", actionLabel="Add Student", onAction=handleAdd
       - `grade-approval.tsx`: icon="checkmark-done-outline", title="All Caught Up", description="No grades pending approval."
       - `term-tracking.tsx`: icon="calendar-outline", title="No Terms Set Up", description="Configure your first school term to get started."
       - `family-meetings.tsx`: icon="people-circle-outline", title="No Meetings Yet", description="Schedule your first family meeting to discuss finances."
       - `manage-subscription.tsx`: typically always has data (subscription status), but handle null case
       - `edit-profile.tsx`: always has profile data, no empty state needed

    4. **Ordering pattern (same as tab screens):**
       ```tsx
       if (isLoading) return <SkeletonComponent />;
       if (error) return <ErrorState message={error.message} onRetry={refetch} />;
       if (!data) return <EmptyState ... />;
       return <Content data={data} />;
       ```

    5. **Ensure consistent container backgrounds:**
       All screens should use `colors.backgroundSecondary` (the light gray) as the base background, matching the tab screens' pattern.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - All 6 data-fetching modal screens have skeleton loading states (no ActivityIndicator spinners remain)
    - All 6 screens have ErrorState with retry on fetch errors
    - Appropriate screens have EmptyState with helpful messages and action buttons
    - Loading -> Error -> Empty -> Content ordering followed consistently
  </verify>
  <done>
    All data-fetching modal/secondary screens have consistent skeleton loading, error state with retry, and empty state with helpful guidance. No ActivityIndicator loading spinners remain anywhere in the app. Combined with Plan 04's tab screen work, every data-fetching view in the entire app has polished loading/error/empty states.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no type errors
2. `grep -r '#[0-9a-fA-F]\{6\}' app/ src/components/ --include='*.tsx' | grep -v shadowColor | grep -v 'rgba' | wc -l` returns 0 (no hardcoded colors outside shadow/rgba in any screen or component)
3. All 9 modal screens use useTheme() hook for colors
4. All data-fetching modal screens show skeleton loading (no ActivityIndicator)
5. All data-fetching modal screens show EmptyState when no data
6. All data-fetching modal screens show ErrorState with retry on errors
7. All touch targets >= 44pt
</verification>

<success_criteria>
- All 9 modal/secondary screens fully themed with useTheme()
- Zero hardcoded hex colors remain across the entire app (app/ and src/components/) outside theme files and shadow/rgba
- Every data-fetching screen in the app (tabs + modals) follows skeleton -> error -> empty -> content pattern
- Friendly empty states guide users with appropriate icons, messages, and action buttons
- Error states have retry buttons for self-service recovery
- 44pt minimum touch targets on all interactive elements
- The entire app is dark-mode-ready through the ThemeContext system
</success_criteria>

<output>
After completion, create `.planning/phases/06-data-management-ui-polish/06-06-SUMMARY.md`
</output>
