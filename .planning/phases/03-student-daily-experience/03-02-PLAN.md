---
phase: 03-student-daily-experience
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - app/(tabs)/daily.tsx
  - app/(tabs)/_layout.tsx
  - app/(tabs)/dashboard.tsx
  - src/components/daily/QODStep.tsx
  - src/components/daily/BehaviorStep.tsx
  - src/components/daily/CompletionCelebration.tsx
autonomous: true

must_haves:
  truths:
    - "Student can complete QOD answer and behavior self-assessment in a single combined flow"
    - "Student sees a progress bar during the combined assessment (50% after QOD, 100% after behavior)"
    - "Student sees a celebration with confetti after completing both steps"
    - "Smart step-skipping: if QOD already answered today, wizard starts at behavior step"
    - "Smart step-skipping: if behavior already done today, wizard starts at celebration/completed view"
    - "Student can tap task cards on dashboard to navigate to daily assessment"
    - "Daily tab appears in student tab bar but NOT in parent tab bar"
    - "After completion, student returns to dashboard where task cards show checkmarks"
    - "All 10 behavior categories are included (5 obligations + 5 opportunities)"
    - "Post-completion re-entry shows read-only completed view, not celebration again"
  artifacts:
    - path: "app/(tabs)/daily.tsx"
      provides: "Combined assessment wizard screen with state-driven steps"
      min_lines: 50
    - path: "src/components/daily/QODStep.tsx"
      provides: "Question presentation with answer selection and correct/incorrect feedback"
      min_lines: 40
    - path: "src/components/daily/BehaviorStep.tsx"
      provides: "10-category behavior self-assessment with 1-5 slider input per category"
      min_lines: 40
    - path: "src/components/daily/CompletionCelebration.tsx"
      provides: "Confetti animation with encouraging message and back-to-dashboard button"
      min_lines: 20
    - path: "app/(tabs)/_layout.tsx"
      provides: "New Daily tab with student-only visibility via href:null pattern"
    - path: "app/(tabs)/dashboard.tsx"
      provides: "Tappable task cards that navigate to /(tabs)/daily"
  key_links:
    - from: "app/(tabs)/daily.tsx"
      to: "src/hooks/useQuestionOfTheDay.ts"
      via: "hook call for QOD data and submission"
      pattern: "useQuestionOfTheDay"
    - from: "app/(tabs)/daily.tsx"
      to: "src/hooks/useBehaviorAssessments.ts"
      via: "hook call for behavior data and submission"
      pattern: "useBehaviorAssessments"
    - from: "app/(tabs)/_layout.tsx"
      to: "daily tab visibility"
      via: "href: userRole === 'parent' ? null"
      pattern: "href.*parent.*null"
    - from: "app/(tabs)/dashboard.tsx"
      to: "/(tabs)/daily"
      via: "router.push on task card tap"
      pattern: "router.*daily"
---

<objective>
Build the student combined daily assessment wizard -- a single screen with QOD + behavior steps, progress bar, smart step-skipping, and confetti celebration.

Purpose: This is the core student daily experience. Students complete their QOD and behavior check-in in one seamless flow instead of navigating to two separate screens. The wizard uses state-driven steps (not multi-screen navigation) to prevent back-button issues and enable smooth transitions.

Output: New `daily.tsx` screen with wizard components, updated tab bar with student-only Daily tab, tappable dashboard task cards.
</objective>

<execution_context>
@/Users/robertisrael/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robertisrael/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-student-daily-experience/03-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create wizard step components (QODStep, BehaviorStep, CompletionCelebration)</name>
  <files>
    src/components/daily/QODStep.tsx
    src/components/daily/BehaviorStep.tsx
    src/components/daily/CompletionCelebration.tsx
  </files>
  <action>
    Create `src/components/daily/` directory and three step components:

    **First, install the slider library:**
    Run: `cd /Users/robertisrael/Documents/GitHub/centsible-scholar-mobile && npx expo install @react-native-community/slider`
    This is included in Expo SDK 54 and works in Expo Go. The user explicitly requested sliders for behavior assessment (CONTEXT.md: "Behavior assessment: 5 sliders for behavior dimensions").

    **1. `src/components/daily/QODStep.tsx`:**
    Props: `{ onComplete: (wasCorrect: boolean) => void }`
    - Uses `useQuestionOfTheDay(gradeLevel)` hook for question data (get gradeLevel from `useStudentProfile`)
    - Shows topic badge, question text, answer options (A/B/C/D) using the same option styling pattern from existing `learn.tsx` (optionLetter circle + option text)
    - Submit button submits via `handleSubmitAnswer()` from the hook
    - After submission: shows correct/incorrect feedback with explanation (green/red card, matching learn.tsx pattern)
    - After showing feedback for ~2 seconds (or on "Continue" tap), calls `onComplete(isCorrect)`
    - If `hasAnsweredToday` is true on mount, immediately call `onComplete(isCorrect)` to skip this step
    - Loading state: ActivityIndicator while hook loads

    **2. `src/components/daily/BehaviorStep.tsx`:**
    Props: `{ onComplete: () => void }`
    - Uses `useBehaviorAssessments(userId)` hook for save and today check
    - Shows ALL 10 behavior categories in two sections: "Obligations" (diet, exercise, work, hygiene, respect) and "Opportunities" (responsibilities, attitude, cooperation, courtesy, service) -- matching the OBLIGATIONS and OPPORTUNITIES arrays from existing `behavior.tsx`
    - **Each category uses a Slider component** (`@react-native-community/slider`), matching the user's stated vision from CONTEXT.md ("5 sliders for behavior dimensions"). Implementation per category:
      - Category label (bold) + description text on one line
      - Below that, a `<Slider>` component with `minimumValue={1}`, `maximumValue={5}`, `step={1}`, `value={scores[key]}`
      - Slider track color: use `minimumTrackTintColor="#4F46E5"` (indigo, matching app theme) and `maximumTrackTintColor="#E5E7EB"` (gray-200)
      - Slider thumb tint: `thumbTintColor="#4F46E5"` (indigo)
      - To the right of the slider (or above it), show the current numeric value with color coding: 1=red (#EF4444), 2=orange (#F97316), 3=yellow (#EAB308), 4=blue (#3B82F6), 5=green (#10B981)
      - Also show the score label next to the number: 1=Poor, 2=Fair, 3=Good, 4=Great, 5=Excellent
    - This pattern matches the web app's `ParentCreateAssessment.tsx` which uses `<Slider value={[scores[key]]} min={1} max={5} step={1} />` with Radix UI sliders. The React Native equivalent is `@react-native-community/slider`.
    - Include "Needs Improvement" and "Excellent" labels at the ends of each slider (matching web app pattern: `<span>Needs Improvement</span> ... <span>Excellent</span>`)
    - Include a brief "Score Guide" legend at top (1=Poor, 2=Fair, 3=Good, 4=Great, 5=Excellent) as a single-line reference
    - Submit button: "Submit Check-in" that calls `saveAssessment({ user_id, date, scores, status: 'submitted' })` then `onComplete()`
    - If `todayAssessment` exists on mount, immediately call `onComplete()` to skip
    - Wrap in ScrollView since 10 categories with sliders will scroll
    - Default all scores to 3 (not 0) for a friendlier starting point in the wizard context
    - Ensure each slider row has adequate vertical spacing (~16px between rows) so sliders are easy to drag without accidentally hitting adjacent ones

    **3. `src/components/daily/CompletionCelebration.tsx`:**
    Props: `{ onDismiss: () => void, wasCorrect?: boolean }`
    - Import `ConfettiCannon` from `react-native-confetti-cannon`
    - Show confetti animation (count=200, autoStart, fadeOut)
    - Warm, encouraging message: "Great work today!" as title
    - Subtitle: "You completed your daily check-in." (or "Perfect! You aced today's question!" if wasCorrect is true)
    - "Back to Dashboard" button calls `onDismiss()`
    - Style: centered content, large text, indigo/white color scheme matching app theme
    - The confetti should fire once on mount, not repeatedly
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `src/components/daily/QODStep.tsx` exists and imports `useQuestionOfTheDay`
    - `src/components/daily/BehaviorStep.tsx` exists with all 10 categories (diet, exercise, work, hygiene, respect, responsibilities, attitude, cooperation, courtesy, service) and imports `Slider` from `@react-native-community/slider`
    - `src/components/daily/CompletionCelebration.tsx` exists and imports `ConfettiCannon`
    - `@react-native-community/slider` appears in package.json dependencies
  </verify>
  <done>Three wizard step components created: QODStep with question/answer/feedback UI, BehaviorStep with all 10 categories using Slider components (min=1, max=5, step=1) matching user's stated vision and web app pattern, CompletionCelebration with confetti and encouraging message.</done>
</task>

<task type="auto">
  <name>Task 2: Create daily.tsx wizard screen, add Daily tab, make dashboard task cards tappable</name>
  <files>
    app/(tabs)/daily.tsx
    app/(tabs)/_layout.tsx
    app/(tabs)/dashboard.tsx
  </files>
  <action>
    **1. Create `app/(tabs)/daily.tsx`:**
    This is a SINGLE SCREEN with state-driven steps (not multi-screen navigation).

    ```typescript
    type WizardStep = 'qod' | 'behavior' | 'celebration' | 'completed';
    ```

    Logic:
    - On mount, check `hasAnsweredToday` from `useQuestionOfTheDay` and `todayAssessment` from `useBehaviorAssessments` to determine starting step:
      - Both done -> 'completed' (read-only view, NOT celebration)
      - QOD done, behavior not -> 'behavior'
      - Neither done -> 'qod'
    - Track `wasCorrect` state to pass to celebration
    - Progress bar at top: 0% at start, 50% after QOD, 100% after behavior, hidden on celebration/completed
    - Progress bar: animated horizontal bar using simple View width percentage, indigo color (#4F46E5), 6px height, rounded corners
    - Step label text: "Step 1 of 2" / "Step 2 of 2" above the progress bar

    Step rendering:
    - 'qod': `<QODStep onComplete={(correct) => { setWasCorrect(correct); setStep('behavior'); }} />`
    - 'behavior': `<BehaviorStep onComplete={() => setStep('celebration')} />`
    - 'celebration': `<CompletionCelebration wasCorrect={wasCorrect} onDismiss={() => router.replace('/(tabs)/dashboard')} />`
    - 'completed': Read-only view showing "All done for today!" with checkmarks for QOD and Behavior, streak count, and a muted "Come back tomorrow!" message. Include a "Back to Dashboard" link.

    Header: SafeAreaView with the progress elements. Set `headerShown: false` in the screen options or use Stack.Screen options so we control the full screen.

    **IMPORTANT re: intermediate celebration for correct QOD answers (from CONTEXT.md):**
    The CONTEXT says "Show mini celebration after CORRECT QOD answers only, then proceed to behavior." Handle this INSIDE QODStep: after a correct answer, show a brief "Nice!" message for 1.5 seconds before calling onComplete. Wrong answers proceed to behavior immediately after showing the explanation.

    **2. Update `app/(tabs)/_layout.tsx`:**
    Add a new `<Tabs.Screen>` for "daily" with student-only visibility. Place it AFTER "dashboard" and BEFORE "grades" in the tab order:

    ```typescript
    <Tabs.Screen
      name="daily"
      options={{
        title: 'Daily',
        headerShown: false,
        href: userRole === 'parent' ? null : '/(tabs)/daily',
        tabBarIcon: ({ color, size }) => (
          <Ionicons name="today-outline" size={size} color={color} />
        ),
      }}
    />
    ```

    This goes right after the `dashboard` Tabs.Screen and before `grades`.

    **3. Update `app/(tabs)/dashboard.tsx`:**
    Make the two task cards ("Question of the Day" and "Behavior Check-in") in the StudentDashboardView tappable. Wrap each in `TouchableOpacity` and navigate to the daily tab on tap:

    ```typescript
    import { useRouter } from 'expo-router';
    // ... in StudentDashboardView:
    const router = useRouter();
    ```

    For the QOD card:
    ```typescript
    <TouchableOpacity
      style={studentStyles.taskCard}
      onPress={() => router.push('/(tabs)/daily')}
      disabled={qodAnsweredToday && !!todayAssessment}
    >
      {/* existing card content */}
    </TouchableOpacity>
    ```

    Same for the Behavior card. If both are complete, disable the cards (they still show green checkmark dots).

    Change the `<View style={studentStyles.taskCard}>` wrappers to `<TouchableOpacity>` for both cards.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `app/(tabs)/daily.tsx` exists with WizardStep type and step-switching logic
    - `app/(tabs)/_layout.tsx` has a `name="daily"` Tabs.Screen with `href: userRole === 'parent' ? null`
    - `app/(tabs)/dashboard.tsx` task cards are wrapped in TouchableOpacity with router.push to daily
    - The daily tab appears between dashboard and grades in _layout.tsx
  </verify>
  <done>Combined assessment wizard screen live with state-driven QOD/behavior/celebration steps, progress bar, smart step-skipping. Daily tab visible to students only. Dashboard task cards navigate to daily assessment on tap.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- Student tab bar shows: Dashboard, Daily, Grades, Behavior, Learn, Settings (6 tabs)
- Parent tab bar shows: Dashboard, Grades, Behavior, Learn, Earnings, Settings (6 tabs, NO Daily)
- daily.tsx wizard transitions: qod -> behavior -> celebration -> dashboard
- Smart skip: if QOD done, starts at behavior; if both done, shows completed view
- All 10 behavior categories present in BehaviorStep with Slider components
- Confetti fires on celebration screen
- Dashboard task cards are tappable and navigate to /(tabs)/daily
</verification>

<success_criteria>
- Student can complete QOD + behavior in a single flow from the Daily tab
- Progress bar shows 50%/100% at appropriate steps
- Confetti celebration appears after completing both steps
- Smart step-skipping works correctly for partial completion
- Re-entry after completion shows read-only view (not celebration)
- Dashboard task cards navigate to daily assessment
- Parent never sees the Daily tab
- All 10 behavior categories included with 1-5 slider scoring (using @react-native-community/slider)
</success_criteria>

<output>
After completion, create `.planning/phases/03-student-daily-experience/03-02-SUMMARY.md`
</output>
